# log-analyzer

Анализатор логов - это утилита, которая обрабатывает файлы логов NGINX для предоставления содержательной статистики о веб-трафике. Она может анализировать как локальные файлы логов, так и логи, доступные по URL. Программа разработана для облегчения анализа логов путем автоматизации таких задач, как подсчет запросов, определение часто запрашиваемых ресурсов, вычисление среднего размера ответа и многое другое.

## Функции

- Подсчет общего количества запросов
- Определение наиболее запрашиваемых ресурсов
- Определение наиболее распространенных кодов HTTP-ответа
- Вычисление среднего размера ответа
- Вычисление 95-го процентиля размеров ответов
- Фильтрация логов по датам и прочим параметрам

## Принцип работы

1. Программа считывает файлы логов NGINX либо из локальных путей, либо из удаленных URL-адресов и преобразует записи в них в структурированные объекты.

2. Если указано, программа фильтрует логи по диапазону дат (параметры from и to) и персональным фильтрам.

3. Затем программа анализирует каждую запись файлов и собирает статистику.

4. Результаты форматируются в отчет в формате Markdown или AsciiDoc.

## Использование
Программа принимает следующие аргументы командной строки:

- --path: Путь к одному или нескольким файлам логов NGINX (может быть локальным путем или URL).
- --from: Необязательная начальная дата в формате ISO8601 (например, 2024-08-31).
- --to: Необязательная конечная дата в формате ISO8601 (например, 2024-09-01).
- --format: Необязательный формат вывода, либо markdown, либо adoc.
- --filter-field: Необязательное поле для фильтрации логов (например, agent, method).
- --filter-value: Необязательное значение для сопоставления в поле --filter-field (например, "Mozilla*", "GET").

### Примеры:

```
analyzer --path logs/2024* --from 2024-08-31 --format markdown
```

```
analyzer --path https://raw.githubusercontent.com/elastic/examples/master/Common%20Data%20Formats/nginx_logs/nginx_logs --format adoc
```

```
analyzer --path logs/**/2024-08-31.txt
```

*Фильтрация по конкретному полю:*
```
analyzer --path logs/2024 --filter-field agent --filter-value "Mozilla"
```
Эта команда фильтрует логи на основе поля agent, отображая только записи, где user-agent начинается с "Mozilla".

```
analyzer --path logs/2024* --filter-field method --filter-value "GET"
```
Эта команда фильтрует логи на основе поля method, отображая только записи с HTTP-методом "GET".

### Формат вывода

Программа выведет анализ в формате markdown или adoc, в зависимости от выбранного формата вывода. Пример вывода markdown:

|       Метрика       | Значение |
|:-------------------:|---------:|
|      Файл(-ы)       |     test |
| Количество запросов |       52 |

| Ресурс | Количество |
|:------:|-----------:|
| /test2 |          4 |
| /test  |          3 |

| Код |          Имя          | Количество |
|:---:|:---------------------:|-----------:|
| 500 | Internal Server Error |          3 |
| 304 |     Not Modified      |          1 |
| 404 |       Not Found       |          2 |

## Особенности
Формат логов: Убедитесь, что логи соответствуют стандартному формату логов NGINX для корректного разбора.

Эффективность использования памяти: Программа использует потоковую обработку для работы с большими файлами логов, не загружая их полностью в память.

Обработка данных: Вся статистика рассчитывается за один проход по данным, что делает программу эффективной.

## Стек

- Java 17
- Maven
- JUnit 5
- Lombok
